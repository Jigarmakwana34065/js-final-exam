<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ToDo App</title>
    <link rel="stylesheet" href="style.css">
</head>

<body>

    <div class="todo-app">
        <div class="container">
            <div class="row">
                <div class="main">
                    <div class="add-task">
                        <h1>todo app list</h1>

                        <input type="text" id="editid">

                        <div class="add">
                            <input type="text" id="task" placeholder="Enter task">

                            <button onclick="addTask()">submit</button>
                        </div>
                    </div>

                    <div class="view-task">

                        <table border="1">
                            <thead>
                                <tr>
                                    <th>Id</th>
                                    <th>Task</th>
                                    <th>Action</th>
                                </tr>
                            </thead>
                            <tbody id="view">

                            </tbody>
                        </table>
                    </div>


                </div>
            </div>
        </div>
    </div>

</body>

<script>

    let data = []

    const addTask = () => {

        let task = document.getElementById('task').value
        let editid = document.getElementById('editid').value
        let id = Math.floor(Math.random() * 1000)

        let data = JSON.parse(localStorage.getItem('user'))

        let obj = {
            task: task,
            id: id
        }

        if (editid) {
            let update = JSON.parse(localStorage.getItem('user'))

            let add = update.filter((val, i) => {
                if (val.id == editid) {
                    val.task = task
                }
                return val
            })

            localStorage.setItem('user', JSON.stringify(add))
            document.getElementById('editid').value = ''
        }
        else {
            if (localStorage.getItem('user') === null && localStorage.getItem('user') === undefined) {
                data.push(obj)
                localStorage.setItem('user', JSON.stringify(data))
            }
            else {
                let record = JSON.parse(localStorage.getItem('user'))

                record.push(obj)

                localStorage.setItem('user', JSON.stringify(record))
            }
        }


        document.getElementById('task').value = ''

        console.log(data);

        viewTask()
    }

    const viewTask = () => {
        record = JSON.parse(localStorage.getItem('user'))

        let tbl = ''

        record.map((val, i) => {
            tbl += `
                <tr>
                    <td>${val.id}</td>
                    <td>${val.task}</td>
                    <td>
                        <button onclick="deleteTask(${val.id})">Delete</button>
                        <button onclick="editTask(${val.id})">Edit</button>
                    </td>
                </tr>
            `
        })

        document.getElementById('view').innerHTML = tbl
    }

    viewTask()

    const deleteTask = (id) => {
        record = JSON.parse(localStorage.getItem('user'))

        let Delete = record.filter((val, i) => {
            return val.id != id
        })

        localStorage.setItem('user', JSON.stringify(Delete))

        viewTask()
    }

    const editTask = (id) => {
        record = JSON.parse(localStorage.getItem('user'))

        editData = record.filter((val, i) => {
            return val.id == id
        })

        document.getElementById('task').value = editData[0].task
        document.getElementById('editid').value = editData[0].id

        console.log(editData);
    }



</script>

</html>